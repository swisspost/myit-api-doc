openapi: '3.0.2'
info:
  title: Incident REST API
  description: handles communication between the MyIT incident system and partner systems.
  version: '1.0.0'

servers:
  - url: https://<MyIT-url>/api/x_ssagd_inc_rest/rest

security:
  - BasicAuth: []
  
paths:
  /incident:
    post:
      summary: create a new incident
      description: creates a new incident in myIT and returns said incident.

      requestBody:
        description: The values to intially write to the incident.
        content:
          application/json:
            schema:
              type: object
              properties:
                partnerId:
                  description: the id of the partner system, agreed upon with the MyIT team.
                  example: "SystemX"
                  type: string
                partnerIncidentId:
                  description: your internal id of the incident, for your reference. Note that this must be unique. Once an incident is closed however - the id is freed up again.
                  example: "1234567890"
                  type: string
                description:
                  description: the descriptive title of the incident.
                  example: "Some problem with something"
                  type: string
                short_description:
                  description: the description of the incident, describing the situation in detail.
                  example: "There is a complicated problem with the incident rest api - HELP!"
                  type: string
                location:
                  description: the name or sys-id of the concerned location. If you don't know what to put here, please ask your swisspost contact.
                  example: "afeeadcb8776c6103efc00000000"
                  type: string
                assignment_group:
                  description: the name or sys-id of the assignment_group this incident should be assigned to. If you don't know what to put here, please ask your swisspost contact.
                  example: "DEVOPS-MYIT"
                  type: string
                cmdb_ci:
                  description: the name or sys-id of the concerned configuration item. If you don't know what to put here, please ask your swisspost contact.
                  example: "w010xq"
                  type: string
                causing_ci:
                  description: the name or sys-id of the underlying causing configuration item. If you don't know what to put here, please ask your swisspost contact.
                  example: "w010xq"
                  type: string
                attachments:
                  description: any attachments you'd like to add to the incident. The content must be base64 encoded.
                  type: array
                  items:
                    type: object
                    properties:
                      fileName:
                        description: the name of the file
                        example: "picture_of_the_problem.png"
                        type: string
                      content_type:
                        description: the mime type of the file
                        example: "image/png"
                        type: string
                      content:
                        type: string
                        description: the content of the file in base64
                        example: c25lYWt5
                        format: byte
              required:
                - partnerId
                - partnerIncidentId
                - description
                - short_description
                - causing_ci

      responses:
        '200':
          description: the created incident
          content:
            application/json:
              schema:
                type: object
                properties:

                  metadata:
                    type: object
                    example: {
                      "config": "SystemX",
                      "partnerId": "SystemX",
                      "server_system_time": "2020-10-24T06:23:41.089Z"
                    }

                  message:
                    type: string
                    example: "Incident 00000000000000000000000000000001 created."

                  data:
                    type: object
                    example: {
                        "incidentId": "6d101e0487e3ca903ef00000000000",
                        "number": "INC0000001",
                        "partnerIncidentId": "1234567890",
                        "description" : "Some problem with something",
                        "short_description": "There is a complicated problem with the incident rest api - HELP!",
                        "state": 1,
                        "opened_at": "1997-09-08T05:55:00Z",
                        "sys_updated_on": "2024-07-17T14:36:59Z",
                        "opened_by": {
                            "first_name": "Example",
                            "last_name": "Name",
                            "user_name": "example_name"
                          },
                        "assignment_group": {
                          "description": "Example group",
                          "name": "Example groupname"
                        },
                        "location": {
                        "city": "Bern",
                        "cmn_location_type": "room",
                        "country": "Switzerland",
                        "full_name": "CH/Bern/Viktoriastrasse 21/Viktoriastrasse 21/1.UG/001",
                        "name": "001"
                        },
                        "causing_ci": {
                          "asset_tag": "123456789",
                          "model_id": {
                            "display_name": "Lenovo ThinkPad P16 Gen1",
                            "name": "ThinkPad P16 Gen1",
                            "sys_id": "70a44cbf87f739d06d000000000000",
                          },
                          "name": "example hostname",
                          "operational_status": 1,
                          "serial_number": "ABCD12345",
                          "sys_id": "acba0c3f87ff75503ef0000000000000",
                        },
                        "attachments": [
                        {
                          "filename": "thisIsAFileName.pdf",
                          "content_type": "application/pdf",
                          "download_url": "https://<MyIT-url>/sys_attachment.do?sys_id=12f0297d87544e12334567890000000",
                          "sys_id": "12f0297d87544e12334567890000000"
                        },
                        {
                          "filename": "picture_of_the_problem.png",
                          "content_type": "image/png",
                          "download_url": "https://<MyIT-url>/sys_attachment.do?sys_id=12f0297d87544e12334567890000001",
                          "sys_id": "12f0297d87544e12334567890000001"
                        },
                      ]
                    }

        '400':
          description: bad request
          content:
            application/json:
              schema:
                type: object
                properties:
                  name:
                    type: string
                    example: "MyItRestException"
                  message:
                    type: string
                    example: "'partnerId' not specified"
                  status:
                    type: integer
                    example: 400
        '401':
          description: unauthorized
          content: 
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: object
                    example: {
                      "message": "User Not Authenticated",
                      "detail": "Required to provide Auth information"
                    }
                  status:
                    type: string
                    example: "failure"
        '500':
          description: internal server error
          content: 
            application/json:
              schema:
                type: object
                properties:
                  name:
                    type: string
                    example: "MyItRestException"
                  message:
                    type: string
                    example: "The action failed due to a business rule. Message: [\"short_description is mandatory.\",\"partnerIncidentId is mandatory.\"]"
                  status:
                    type: integer
                    example: 500

    get:
      summary: fetch an existing incident
      description: Requires 'partnerId' AND either 'incidentId' OR 'partnerIncidentId' and returns the corresponding incident.
      parameters:
        - name: partnerId
          in: query
          required: true
          description: The id of the partner system, to be agreed upon with the MyIT team.
          example: "SystemX"
          schema:
            type: string
        - name: incidentId
          in: query
          required: true
          description: The MyIT-internal id of the incident.
          example: 6d101e0487e3ca903ef00000000000
          schema:
            type: string
        - name: partnerIncidentId
          in: query
          required: true
          description: your internal id of the incident, for your reference.  Note that this must be unique. Once an incident is closed however - the id is freed up again.
          example: "1234567890"
          schema:
            type: string
      responses:
        '200':
          description: the incident corresponding to the incidentId or partnerIncidentId.
          content: 
            application/json:
              schema:
                type: object
                properties:
                  metadata:
                    type: object
                    example: {
                      "config": "SystemX",
                      "partnerId": "SystemX",
                      "server_system_time": "2020-10-24T06:23:41.089Z"
                    }
                  data:
                    type: object
                    example: {
                        "incidentId": "6d101e0487e3ca903ef00000000000",
                        "number": "INC0000001",
                        "partnerIncidentId": "12345",
                        "short_description": "descriptive text",
                        "state": 1,
                        "opened_at": "1997-09-08T05:55:00Z",
                        "sys_updated_on": "2024-07-17T14:36:59Z",
                        "u_current_workplace": "workplace 123",
                        "opened_by": {
                            "first_name": "Example",
                            "last_name": "Name",
                            "user_name": "example_name"
                          },
                        "assignment_group": {
                          "description": "Example group",
                          "name": "Example groupname"
                        },
                        "causing_ci": {
                          "asset_tag": "123456789",
                          "model_id": {
                            "display_name": "Lenovo ThinkPad P16 Gen1",
                            "name": "ThinkPad P16 Gen1",
                            "sys_id": "70a44cbf87f739d06d000000000000",
                          },
                          "name": "example hostname",
                          "operational_status": 1,
                          "serial_number": "ABCD12345",
                          "sys_id": "acba0c3f87ff75503ef0000000000000",
                        },
                        "attachments": [
                        {
                          "filename": "thisIsAFileName.pdf",
                          "content_type": "application/pdf",
                          "download_url": "https://<MyIT-url>/sys_attachment.do?sys_id=12f0297d87544e12334567890000000",
                          "sys_id": "12f0297d87544e12334567890000000"
                        }
                      ]
                    }
        '400':
          description: bad request
          content: 
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: object
                    example: "MyItRestException"
                  message:
                    type: string
                    example: "'partnerId' not specified"
                  status:
                    type: integer
                    example: 400
        '401':
          description: unauthorized
          content: 
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: object
                    example: {
                      "message": "User Not Authenticated",
                      "detail": "Required to provide Auth information"
                    }
                  status:
                    type: string
                    example: "failure"
                    
    patch:
      summary: update an incident
      description: updates an incident that already exists in myIT. 'partnerId' AND 'incidentId' OR 'partnerIncidentId' must either be in the body or the query params.
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                partnerId:
                  description: the id of the partner system, agreed upon with the MyIT team.
                  example: "SystemX"
                  type: string
                incidentId:
                  description: The MyIT-internal id of the incident.
                  example: 43c569a98771f5106dc8630000000000
                  type: string
                partnerIncidentId:
                  description: your internal id of the incident, for your reference.  Note that this must be unique. Once an incident is closed however - the id is freed up again.
                  example: "1234567890"
                  type: string
                short_description:
                  type: string
                  description: example field to update
                  example: this is an updated description of the problem

              required:
                - partnerId
                - incidentId
                - partnerIncidentId

      responses:
        '200':
          description: the updated incident
          content:
            application/json:
              schema:
                type: object
                properties:
                  metadata:
                    type: object
                    example: {
                      "config": "SystemX",
                      "partnerId": "SystemX",
                      "server_system_time": "2020-10-24T06:23:41.089Z"
                    }

                  message:
                    type: string
                    example: "Incident 43c569a98771f5106dc8630000000000 updated."

                  data:
                    type: object
                    example: {
                        "incidentId": "6d101e0487e3ca903ef00000000000",
                        "number": "INC0000001",
                        "partnerIncidentId": "1234567890",
                        "short_description": "this is an updated description of the problem",
                        "state": 1,
                        "opened_at": "1997-09-08T05:55:00Z",
                        "sys_updated_on": "2024-07-17T14:36:59Z",
                        "opened_by": {
                            "first_name": "Example",
                            "last_name": "Name",
                            "user_name": "example_name"
                          },
                        "assignment_group": {
                          "description": "Example group",
                          "name": "Example groupname"
                        },
                        "causing_ci": {
                          "asset_tag": "123456789",
                          "model_id": {
                            "display_name": "Lenovo ThinkPad P16 Gen1",
                            "name": "ThinkPad P16 Gen1",
                            "sys_id": "70a44cbf87f739d06d000000000000",
                          },
                          "name": "example hostname",
                          "operational_status": 1,
                          "serial_number": "ABCD12345",
                          "sys_id": "acba0c3f87ff75503ef0000000000000",
                        },
                        "attachments": [
                        {
                          "filename": "thisIsAFileName.pdf",
                          "content_type": "application/pdf",
                          "download_url": "https://<MyIT-url>/sys_attachment.do?sys_id=12f0297d87544e12334567890000000",
                          "sys_id": "12f0297d87544e12334567890000000"
                        }
                      ]
                    }

        '400':
          description: bad request
          content: 
            application/json:
              schema:
                type: object
                properties:
                  name:
                    type: string
                    example: "MyItRestException"
                  message:
                    type: string
                    example: "'partnerId' not specified"
                  status:
                    type: integer
                    example: 400
        '401':
          description: unauthorized
          content: 
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: object
                    example: {
                      "message": "User Not Authenticated",
                      "detail": "Required to provide Auth information"
                    }
                  status:
                    type: string
                    example: "failure"

  /incident/addAttachment:
    patch:
      summary: add attachments
      description: adds attachments to an incident that already exists in myIT. 'partnerId' AND either 'incidentId' OR 'partnerIncidentId' must either be in the body or the query params. Any attachments must be base64 encoded.
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                partnerId:
                  description: the id of the partner system, agreed upon with the MyIT team.
                  example: "SystemX"
                  type: string
                incidentId:
                  description: The MyIT-internal id of the incident.
                  example: 6d101e0487e3ca903ef00000000000
                  type: string
                partnerIncidentId:
                  description: your internal id of the incident, for your reference.  Note that this must be unique. Once an incident is closed however - the id is freed up again.
                  example: "1234567890"
                  type: string
                attachments:
                  description: any attachments you'd like to add to the incident. The content must be base64 encoded.
                  type: array
                  items:
                    type: object
                    properties:
                      fileName:
                        description: the name of the file
                        example: "picture_of_the_problem.png"
                        type: string
                      content_type:
                        description: the mime type of the file
                        example: "image/png"
                        type: string
                      content:
                        type: string
                        description: the content of the file in base64
                        example: c25lYWt5
                        format: byte

      responses:
        '200':
          description: the updated incident
          content:
            application/json:
              schema:
                type: object
                properties:
                  metadata:
                    type: object
                    example: {
                          "Caveat": "THIS IS PRE-ALPHA CODE AND SUBJECT TO CHANGE AT ANY TIM(E)!",
                          "git": "IncidentRestApi-0.0.1+70-dd86b01-dirty",
                          "build": "2023-10-24T14:54:24.706Z",
                          "config": "systemId",
                          "partnerId": "systemId",
                          "server_system_time": "2023-10-27T07:02:46.583Z"
                    }

                  message:
                    type: string
                    example: "Attachment(s) added to Incident 43c569a98771f5106dc8630000000000."

                  data:
                    type: object
                    example: {
                          "number": "INC0000001",
                          "short_description": "short description",
                          "priority": 4,
                          "opened_by:": {
                              "active": true,
                              "sys_class_name": "sys_user",
                              "sys_id": "a6fb235587fc71503efcec000000000"
                          },
                          "severity": 3,
                          "opened_at": "2023-10-10T07:22:04Z",
                          "category": "service_request",
                          "incident_id": "43c569a98771f5106dc8630000000000",
                          "class": "incident",
                          "attachments": [
                            {
                              "filename": "thisIsAFileName.txt",
                              "content_type": "application/json",
                              "download_url": "https://<MyIT-url>/sys_attachment.do?sys_id=af0192da874481234567890123456789",
                              "sys_id": "af0192da874481234567890123456789"
                            }
                          ]
                        
                    }

        '400':
          description: bad request
          content: 
            application/json:
              schema:
                type: object
                properties:
                  name:
                    type: string
                    example: "MyItRestException"
                  message:
                    type: string
                    example: "content of attachment thisIsAFileName.txt is not valid base64."
                  status:
                    type: integer
                    example: 400
        '401':
          description: unauthorized
          content: 
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: object
                    example: {
                      "message": "User Not Authenticated",
                      "detail": "Required to provide Auth information"
                    }
                  status:
                    type: string
                    example: "failure"

  /incident/addWorknote:
    patch:
      summary: add a worknote
      description: adds a worknote to an incident that already exists in myIT. PartnerId AND either IncidentId OR partnerIncidentId must either be in the body or the query params.
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                partnerId:
                  type: string
                incidentId:
                  type: string
                partnerIncidentId:
                  type: string
                worknote:
                  type: string

      responses:
        '200':
          description: the updated incident
          content:
            application/json:
              schema:
                type: object
                properties:
                  metadata:
                    type: object
                    example: {
                          "Caveat": "THIS IS PRE-ALPHA CODE AND SUBJECT TO CHANGE AT ANY TIM(E)!",
                          "git": "IncidentRestApi-0.0.1+70-dd86b01-dirty",
                          "build": "2023-10-24T14:54:24.706Z",
                          "config": "systemId",
                          "partnerId": "systemId",
                          "server_system_time": "2023-10-27T07:02:46.583Z"
                    }

                  message:
                    type: string
                    example: "Worknote added to incident 43c569a98771f5106dc8630000000000."

                  data:
                    type: object
                    example: {
                          "number": "INC0000001",
                          "short_description": "short description",
                          "priority": 4,
                          "opened_by:": {
                              "active": true,
                              "sys_class_name": "sys_user",
                              "sys_id": "a6fb235587fc71503efcec000000000"
                          },
                          "severity": 3,
                          "opened_at": "2023-10-10T07:22:04Z",
                          "category": "service_request",
                          "incident_id": "43c569a98771f5106dc8630000000000",
                          "class": "incident",
                          "worknotes": [
                            {
                              "sys_id" : "ta6fb235587fc71503efcec000000123",
                              "sys_created_by" : "admin.user",
                              "sys_created_on" : "2024-01-24T06:29:35Z",
                              "value" : "worknote detailing progress on incident\r\nTest"
                            }
                          ]
                    }

        '400':
          description: bad request
          content: 
            application/json:
              schema:
                type: object
                properties:
                  name:
                    type: string
                    example: "MyItRestException"
                  message:
                    type: string
                    example: "No worknote found in request body."
                  status:
                    type: integer
                    example: 400
        '401':
          description: unauthorized
          content: 
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: object
                    example: {
                      "message": "User Not Authenticated",
                      "detail": "Required to provide Auth information"
                    }
                  status:
                    type: string
                    example: "failure"

  /incident/addComment:
    patch:
      summary: add a comment
      description: adds a comment to an incident that already exists in myIT. 'partnerId' AND either 'incidentId' OR 'partnerIncidentId' must either be in the body or the query params.
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                partnerId:
                  type: string
                incidentId:
                  type: string
                partnerIncidentId:
                  type: string
                comment:
                  type: string

      responses:
        '200':
          description: the updated incident
          content:
            application/json:
              schema:
                type: object
                properties:
                  metadata:
                    type: object
                    example: {
                          "Caveat": "THIS IS PRE-ALPHA CODE AND SUBJECT TO CHANGE AT ANY TIM(E)!",
                          "git": "IncidentRestApi-0.0.1+70-dd86b01-dirty",
                          "build": "2023-10-24T14:54:24.706Z",
                          "config": "systemId",
                          "partnerId": "systemId",
                          "server_system_time": "2023-10-27T07:02:46.583Z"
                    }

                  message:
                    type: string
                    example: "Comment added to incident 43c569a98771f5106dc8630000000000."

                  data:
                    type: object
                    example: {
                          "number": "INC0000001",
                          "short_description": "short description",
                          "priority": 4,
                          "opened_by:": {
                              "active": true,
                              "sys_class_name": "sys_user",
                              "sys_id": "a6fb235587fc71503efcec000000000"
                          },
                          "severity": 3,
                          "opened_at": "2023-10-10T07:22:04Z",
                          "category": "service_request",
                          "incident_id": "43c569a98771f5106dc8630000000000",
                          "class": "incident",
                          "comments": [
                            {
                              "sys_id" : "ta6fb235587fc71503efcec000000123",
                              "sys_created_by" : "admin.user",
                              "sys_created_on" : "2024-01-24T06:29:35Z",
                              "value" : "Customer-facing comment, detailing progress on incident\r\nTest"
                            }
                          ]
                    }

        '400':
          description: bad request
          content: 
            application/json:
              schema:
                type: object
                properties:
                  name:
                    type: string
                    example: "MyItRestException"
                  message:
                    type: string
                    example: "comment must be of type string."
                  status:
                    type: integer
                    example: 400
        '401':
          description: unauthorized
          content: 
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: object
                    example: {
                      "message": "User Not Authenticated",
                      "detail": "Required to provide Auth information"
                    }
                  status:
                    type: string
                    example: "failure"
  
  /incident/resolve:
    patch:
      summary: resolve an incident
      description: resolves an incident in myIT. Requires a worknote. PartnerId AND either IncidentId OR partnerIncidentId must either be in the body or the query params.
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                partnerId:
                  type: string
                incidentId:
                  type: string
                partnerIncidentId:
                  type: string
                worknote:
                  type: string
              required:
                - partnerId
                - incidentId
                - partnerIncidentId
                - worknote


      responses:
        '200':
          description: the resolved incident
          content:
            application/json:
              schema:
                type: object
                properties:
                  metadata:
                    type: object
                    example: {
                          "Caveat": "THIS IS PRE-ALPHA CODE AND SUBJECT TO CHANGE AT ANY TIM(E)!",
                          "git": "IncidentRestApi-0.0.1+70-dd86b01-dirty",
                          "build": "2023-10-24T14:54:24.706Z",
                          "config": "systemId",
                          "partnerId": "systemId",
                          "server_system_time": "2023-10-27T07:02:46.583Z"
                    }

                  message:
                    type: string
                    example: "Incident 43c569a98771f5106dc8630000000000 resolved."

                  data:
                    type: object
                    example: {
                          "number": "INC0000001",
                          "short_description": "short description",
                          "priority": 4,
                          "opened_by:": {
                              "active": true,
                              "sys_class_name": "sys_user",
                              "sys_id": "a6fb235587fc71503efcec000000000"
                          },
                          "severity": 3,
                          "opened_at": "2023-10-10T07:22:04Z",
                          "category": "service_request",
                          "incident_id": "43c569a98771f5106dc8630000000000",
                          "class": "incident",
                          "worknotes": [
                            {
                              "sys_id" : "ta6fb235587fc71503efcec000000123",
                              "sys_created_by" : "admin.user",
                              "sys_created_on" : "2024-01-24T06:29:35Z",
                              "value" : "reason for reopening incident\r\nTest"
                            }
                          ]
                    }

        '400':
          description: bad request
          content: 
            application/json:
              schema:
                type: object
                properties:
                  name:
                    type: string
                    example: "MyItRestException"
                  message:
                    type: string
                    example: "No worknote found in request body."
                  status:
                    type: integer
                    example: 400
        '401':
          description: unauthorized
          content: 
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: object
                    example: {
                      "message": "User Not Authenticated",
                      "detail": "Required to provide Auth information"
                    }
                  status:
                    type: string
                    example: "failure"

  /incident/reopen:
    patch:
      summary: reopen an incident
      description: Reopens an incident in myIT that has status 'resolved'. Requires a worknote. PartnerId AND either IncidentId OR partnerIncidentId must either be in the body or the query params.
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                partnerId:
                  type: string
                incidentId:
                  type: string
                partnerIncidentId:
                  type: string
                worknote:
                  type: string
              required:
                - partnerId
                - incidentId
                - partnerIncidentId
                - worknote


      responses:
        '200':
          description: the reopened incident
          content:
            application/json:
              schema:
                type: object
                properties:
                  metadata:
                    type: object
                    example: {
                          "Caveat": "THIS IS PRE-ALPHA CODE AND SUBJECT TO CHANGE AT ANY TIM(E)!",
                          "git": "IncidentRestApi-0.0.1+70-dd86b01-dirty",
                          "build": "2023-10-24T14:54:24.706Z",
                          "config": "systemId",
                          "partnerId": "systemId",
                          "server_system_time": "2023-10-27T07:02:46.583Z"
                    }

                  message:
                    type: string
                    example: "Incident 43c569a98771f5106dc8630000000000 reopened."

                  data:
                    type: object
                    example: {
                          "number": "INC0000001",
                          "short_description": "short description",
                          "priority": 4,
                          "opened_by:": {
                              "active": true,
                              "sys_class_name": "sys_user",
                              "sys_id": "a6fb235587fc71503efcec000000000"
                          },
                          "severity": 3,
                          "opened_at": "2023-10-10T07:22:04Z",
                          "category": "service_request",
                          "incident_id": "43c569a98771f5106dc8630000000000",
                          "class": "incident",
                          "worknotes": [
                            {
                              "sys_id" : "ta6fb235587fc71503efcec000000123",
                              "sys_created_by" : "admin.user",
                              "sys_created_on" : "2024-01-24T06:29:35Z",
                              "value" : "reason for reopening incident\r\nTest"
                            }
                          ]
                    }

        '400':
          description: bad request
          content: 
            application/json:
              schema:
                type: object
                properties:
                  name:
                    type: string
                    example: "MyItRestException"
                  message:
                    type: string
                    example: "No worknote found in request body."
                  status:
                    type: integer
                    example: 400
        '401':
          description: unauthorized
          content: 
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: object
                    example: {
                      "message": "User Not Authenticated",
                      "detail": "Required to provide Auth information"
                    }
                  status:
                    type: string
                    example: "failure"

  /callback:
    post:
      summary: Notification via POST request
      description: Sends a POST request to the partner's callback URL when an incident changes containing the complete incident.
      requestBody:
        description: The incident data sent to the callback URL.
        content:
          application/json:
            schema:
              type: object
              properties:
                metaData:
                  type: string
                  example: "The incident has changed. This is the newest state:"
                number:
                  type: string
                  example: "INC0000001"
                time_worked:
                  type: string
                  example: "1970-01-01 01:54:46"
                short_description:
                  type: string
                  example: "update"
                priority:
                  type: number
                  example: 1
                severity:
                  type: number
                  example: 2
                opened_at:
                  type: string
                  example: "2023-11-23T09:16:47Z"
                category:
                  type: string
                  example: "service_request"
                incident_id:
                  type: string
                  example: "f806607f87a6f9d03efcec0000000000"
                class:
                  type: string
                  example: "incident"
      responses:
        '200':
          description: Callback request description. Actual response handling is managed by the receiving system.
        'default':
          description: General response. Actual response handling is managed by the receiving system.

    get:
      summary: Notification via GET request
      description: Sends a GET request to the partner's callback URL with incidentId and callbackUrl as query parameters when an incident changes. This URL can be queried with GET to then receive the changed incident.
      parameters:
        - name: incidentId
          in: query
          description: The ID of the incident that changed.
          schema:
            type: string
            example: f806607f87a6f9d03efcec0000000000
        - name: callbackUrl
          in: query
          description: The readymade URL leading to the changed incident.
          schema:
            type: string
            example: https://<MyIT-url>/api/x_ssagd_inc_rest/rest/incident?partnerId=systemX&incidentId=f806607f87a6f9d03efcec0000000000
      responses:
        '200':
          description: Callback request description. Actual response handling is managed by the receiving system.
        'default':
          description: General response. Actual response handling is managed by the receiving system.

components:
  securitySchemes:
    BasicAuth:
      type: http
      scheme: basic

